!function($,t,e,o){function i(t,e){var o=Math.max(0,t[0]-e[0],e[0]-t[1]),i=Math.max(0,t[2]-e[1],e[1]-t[3]);return o+i}function r(t,e,o,i){var r=t.length,s=i?"offset":"position";for(o=o||0;r--;){var n=t[r].el?t[r].el:$(t[r]),a=n[s]();a.left+=parseInt(n.css("margin-left"),10),a.top+=parseInt(n.css("margin-top"),10),e[r]=[a.left-o,a.left+n.outerWidth()+o,a.top-o,a.top+n.outerHeight()+o]}}function s(t,e){var o=e.offset();return{left:t.left-o.left,top:t.top-o.top}}function n(t,e,o){e=[e.left,e.top],o=o&&[o.left,o.top];for(var r,s=t.length,n=[];s--;)r=t[s],n[s]=[s,i(r,e),o&&i(r,o)];return n=n.sort(function(t,e){return e[1]-t[1]||e[2]-t[2]||e[0]-t[0]})}function a(t){this.options=$.extend({},c,t),this.containers=[],this.options.rootGroup||(this.scrollProxy=$.proxy(this.scroll,this),this.dragProxy=$.proxy(this.drag,this),this.dropProxy=$.proxy(this.drop,this),this.placeholder=$(this.options.placeholder),t.isValidTarget||(this.options.isValidTarget=o))}function l(t,e){this.el=t,this.options=$.extend({},h,e),this.group=a.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var o=this.rootGroup.options.itemPath;this.target=o?this.el.find(o):this.el,this.target.on(f.start,this.handle,$.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var h={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},c={afterMove:function(t,e,o){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(t,e){return!0},onCancel:function(t,e,o,i){},onDrag:function(t,e,o,i){t.css(e)},onDragStart:function(t,e,o,i){t.css({height:t.outerHeight(),width:t.outerWidth()}),t.addClass(e.group.options.draggedClass),$("body").addClass(e.group.options.bodyClass)},onDrop:function(t,e,o,i){t.removeClass(e.group.options.draggedClass).removeAttr("style"),$("body").removeClass(e.group.options.bodyClass)},onMousedown:function(t,e,o){if(!o.target.nodeName.match(/^(input|select|textarea)$/i))return o.preventDefault(),!0},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function(t,e,o){var i=$.extend({},t.data());return o?[e]:(e[0]&&(i.children=e),delete i.subContainers,delete i.sortable,i)},tolerance:0},u={},d=0,p={left:0,top:0,bottom:0,right:0},f={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},g="subContainers";a.get=function(t){return u[t.group]||(t.group===o&&(t.group=d++),u[t.group]=new a(t)),u[t.group]},a.prototype={dragInit:function(t,e){this.$document=$(e.el[0].ownerDocument);var o=$(t.target).closest(this.options.itemSelector);if(o.length){if(this.item=o,this.itemContainer=e,this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,c.onMousedown,t))return;this.setPointer(t),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0}},drag:function(t){if(!this.dragging){if(!this.distanceMet(t)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,c.onDragStart,t),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(t),this.options.onDrag(this.item,s(this.pointer,this.item.offsetParent()),c.onDrag,t);var e=this.getPointer(t),i=this.sameResultBox,r=this.options.tolerance;(!i||i.top-r>e.top||i.bottom+r<e.top||i.left-r>e.left||i.right+r<e.left)&&(this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=o))},drop:function(t){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,c.onCancel,t),this.options.onDrop(this.item,this.getContainer(this.item),c.onDrop,t),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=o,this.dragging=!1)},searchValidTarget:function(t,e){t||(t=this.relativePointer||this.pointer,e=this.lastRelativePointer||this.lastPointer);for(var i=n(this.getContainerDimensions(),t,e),r=i.length;r--;){var a=i[r][0],l=i[r][1];if(!l||this.options.pullPlaceholder){var h=this.containers[a];if(!h.disabled){if(!this.$getOffsetParent()){var c=h.getItemOffsetParent();t=s(t,c),e=s(e,c)}if(h.searchValidTarget(t,e))return!0}}}this.sameResultBox&&(this.sameResultBox=o)},movePlaceholder:function(t,e,o,i){var r=this.lastAppendedItem;!i&&r&&r[0]===e[0]||(e[o](this.placeholder),this.lastAppendedItem=e,this.sameResultBox=i,this.options.afterMove(this.placeholder,t,e))},getContainerDimensions:function(){return this.containerDimensions||r(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(t){return t.closest(this.options.containerSelector).data(e)},$getOffsetParent:function(){if(this.offsetParent===o){var t=this.containers.length-1,e=this.containers[t].getItemOffsetParent();if(!this.options.rootGroup)for(;t--;)if(e[0]!=this.containers[t].getItemOffsetParent()[0]){e=!1;break}this.offsetParent=e}return this.offsetParent},setPointer:function(t){var e=this.getPointer(t);if(this.$getOffsetParent()){var o=s(e,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=o}this.lastPointer=this.pointer,this.pointer=e},distanceMet:function(t){var e=this.getPointer(t);return Math.max(Math.abs(this.pointer.left-e.left),Math.abs(this.pointer.top-e.top))>=this.options.distance},getPointer:function(t){var e=t.originalEvent||t.originalEvent.touches&&t.originalEvent.touches[0];return{left:t.pageX||e.pageX,top:t.pageY||e.pageY}},setupDelayTimer:function(){var t=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){t.delayMet=!0},this.options.delay))},scroll:function(t){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(t){var e=this,o=["drag","drop","scroll"];$.each(o,function(o,i){e.$document[t](f[i],e[i+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=o},clearDimensions:function(){this.traverse(function(t){t._clearDimensions()})},traverse:function(t){t(this);for(var e=this.containers.length;e--;)this.containers[e].traverse(t)},_clearDimensions:function(){this.containerDimensions=o},_destroy:function(){u[this.options.group]=o}},l.prototype={dragInit:function(t){var e=this.rootGroup;!this.disabled&&!e.dragInitDone&&this.options.drag&&this.isValidDrag(t)&&e.dragInit(t,this)},isValidDrag:function(t){return 1==t.which||"touchstart"==t.type&&1==t.originalEvent.touches.length},searchValidTarget:function(t,e){var o=n(this.getItemDimensions(),t,e),i=o.length,r=this.rootGroup,s=!r.options.isValidTarget||r.options.isValidTarget(r.item,this);if(!i&&s)return r.movePlaceholder(this,this.target,"append"),!0;for(;i--;){var a=o[i][0],l=o[i][1];if(!l&&this.hasChildGroup(a)){var h=this.getContainerGroup(a).searchValidTarget(t,e);if(h)return!0}else if(s)return this.movePlaceholder(a,t),!0}},movePlaceholder:function(t,e){var o=$(this.items[t]),i=this.itemDimensions[t],r="after",s=o.outerWidth(),n=o.outerHeight(),a=o.offset(),l={left:a.left,right:a.left+s,top:a.top,bottom:a.top+n};if(this.options.vertical){var h=(i[2]+i[3])/2,c=e.top<=h;c?(r="before",l.bottom-=n/2):l.top+=n/2}else{var u=(i[0]+i[1])/2,d=e.left<=u;d?(r="before",l.right-=s/2):l.left+=s/2}this.hasChildGroup(t)&&(l=p),this.rootGroup.movePlaceholder(this,o,r,l)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),r(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var t,e=this.el;return t="relative"===e.css("position")||"absolute"===e.css("position")||"fixed"===e.css("position")?e:e.offsetParent()},hasChildGroup:function(t){return this.options.nested&&this.getContainerGroup(t)},getContainerGroup:function(t){var i=$.data(this.items[t],g);if(i===o){var r=this.$getChildren(this.items[t],"container");if(i=!1,r[0]){var s=$.extend({},this.options,{rootGroup:this.rootGroup,group:d++});i=r[e](s).data(e).group}$.data(this.items[t],g,i)}return i},$getChildren:function(t,e){var o=this.rootGroup.options,i=o[e+"Path"],r=o[e+"Selector"];return t=$(t),i&&(t=t.find(i)),t.children(r)},_serialize:function(t,e){var o=this,i=e?"item":"container",r=this.$getChildren(t,i).not(this.options.exclude).map(function(){return o._serialize($(this),!e)}).get();return this.rootGroup.options.serialize(t,r,e)},traverse:function(t){$.each(this.items||[],function(e){var o=$.data(this,g);o&&o.traverse(t)}),t(this)},_clearDimensions:function(){this.itemDimensions=o},_destroy:function(){var t=this;this.target.off(f.start,this.handle),this.el.removeData(e),this.options.drop&&(this.group.containers=$.grep(this.group.containers,function(e){return e!=t})),$.each(this.items||[],function(){$.removeData(this,g)})}};var m={enable:function(){this.traverse(function(t){t.disabled=!1})},disable:function(){this.traverse(function(t){t.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(t){t._clearDimensions()})},destroy:function(){this.traverse(function(t){t._destroy()})}};$.extend(l.prototype,m),$.fn[e]=function(t){var i=Array.prototype.slice.call(arguments,1);return this.map(function(){var r=$(this),s=r.data(e);return s&&m[t]?m[t].apply(s,i)||this:(s||t!==o&&"object"!=typeof t||r.data(e,new l(r,t)),this)})}}(jQuery,window,"sortable");var sce_connection_error="Please check your internet connection!",sce_unknown_error="Sorry, there was an unknown error";jQuery(document).ready(function(){"yes"!=sce_disable_lightbox&&jQuery(".sce-topbar nav a.sce-lightbox, .sce_edit_button, .sce_edit_button_small").nivoLightbox({beforeHideLightbox:function(){window.location.reload()}});var t=jQuery("ol.sce_loop_container").sortable({handle:".sce_row_number",onDrop:function(e,o,i){var r=t.sortable("serialize").get(),s=JSON.stringify(r,null," ");loop_id=jQuery(e).attr("data-loop"),loop_row=jQuery(e).attr("data-row"),t.sortable("disable"),jQuery.post(sce_ajax_url+"/move-row/"+loop_id,{loop_id:loop_id,data:s},function(t){"true"==t.return?(window.location.reload(),jQuery("#sce_loop_"+loop_id+"-row_1 .sce_loop--"+loop_id+"--row_container").each(function(t){jQuery(this).attr("data-row",t+1),jQuery(this).attr("id","sce_loop_id--"+loop_id+"---row--"+(t+1))})):(alert(sce_unknown_error),window.location.reload())}).fail(function(){alert(sce_connection_error)}),i(e,o)}});jQuery(".sce_image_lightbox").nivoLightbox(),jQuery(".sce_add_new_row").on("click",function(){return jQuery(".fa",this).hide(),jQuery(".fa-spin",this).show(),loop_id=jQuery(this).attr("data-loop"),row=jQuery(this).attr("data-row"),jQuery.post(sce_ajax_url+"/add-row/"+loop_id+"/"+row,{loop_id:loop_id,row:row},function(t){"true"==t.return?window.location.reload():(alert(sce_unknown_error),window.location.reload())}).fail(function(){alert(sce_connection_error)}),!1}),jQuery(".sce_delete_row").on("click",function(){return jQuery(".fa",this).hide(),jQuery(".fa-spin",this).show(),loop_id=jQuery(this).attr("data-loop"),row=jQuery(this).attr("data-row"),jQuery.post(sce_ajax_url+"/del-row/"+loop_id+"/"+row,{loop_id:loop_id,row:row},function(t){"true"==t.return?window.location.reload():(alert(sce_unknown_error),window.location.reload())}).fail(function(){alert(sce_connection_error)}),!1})}),CKEDITOR.on("instanceCreated",function(t){var e=t.editor,o=e.element,i=jQuery(o).attr("data-id"),r=jQuery(o).attr("data-loop"),s=jQuery(o).attr("data-row"),n=jQuery(o).attr("data-type");e.on("configLoaded",function(){e.config.filebrowserImageUploadUrl=sce_filebrowserImageUploadUrl,e.config.floatSpaceDockedOffsetY=50,e.config.language=sce_lang,"short"!=n&&"long"!=n||(e.config.removePlugins="toolbar",e.config.enterMode=CKEDITOR.ENTER_BR,e.config.shiftEnterMode=CKEDITOR.ENTER_BR,e.config.autoParagraph=!1),"Full"==sce_editor_mode?e.config.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","blocks","align"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"}]:"Basic"==sce_editor_mode?e.config.toolbarGroups=[{name:"document",groups:["mode"]},{name:"basicstyles",groups:["basicstyles"]},{name:"paragraph",groups:["list","align"]},{name:"links"},{name:"tools"}]:e.config.toolbarGroups=[{name:"document",groups:["mode"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"links"},{name:"insert"},{name:"tools"},"/",{name:"basicstyles",groups:["basicstyles"]},{name:"paragraph",groups:["list","align"]},{name:"styles"},{name:"colors"},{name:"others"}]}),e.on("instanceReady",function(t){"html5"==sce_code_style?t.editor.dataProcessor.writer.selfClosingEnd=">":t.editor.dataProcessor.writer.selfClosingEnd=" />"}),e.on("blur",function(){var e=t.editor.getData(),o=jQuery.ajax({url:sce_ajax_url+"/update-text/"+i+"/",type:"POST",data:{sce_id:i,sce_loop:r,sce_row:s,text:e,type:n},dataType:"html"})})});